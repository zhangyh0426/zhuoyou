# å¾®ä¿¡äº‘æ•°æ®åº“è¿æ¥å®ŒæˆæŒ‡å—

## ğŸ‰ é¡¹ç›®å·²æˆåŠŸè¿æ¥åˆ°å¾®ä¿¡äº‘æ•°æ®åº“ï¼

### ğŸ“‹ ç¯å¢ƒä¿¡æ¯
- **ç¯å¢ƒID**: `cloud1-2gq89p31220bb320`
- **äº‘å‡½æ•°**: `userAuth` (å·²æ›´æ–°æ”¯æŒäº‘æ•°æ®åº“æ“ä½œ)
- **æ•°æ®åº“å·¥å…·ç±»**: `utils/weixin-cloud-database.js`

### ğŸš€ å·²å®Œæˆçš„åŠŸèƒ½

#### 1. äº‘æ•°æ®åº“åˆå§‹åŒ–
- âœ… äº‘å¼€å‘ç¯å¢ƒåˆå§‹åŒ–
- âœ… æ•°æ®åº“è¿æ¥æµ‹è¯•
- âœ… é›†åˆè‡ªåŠ¨åˆ›å»º
- âœ… äº‘å‡½æ•°ä¾èµ–æ›´æ–°

#### 2. æ•°æ®åº“å·¥å…·ç±»åŠŸèƒ½
- âœ… ç”¨æˆ·æ•°æ®ç®¡ç† (å¢åˆ æ”¹æŸ¥)
- âœ… ä¼šå‘˜å¡ç®¡ç† (ä½™é¢ã€ç§¯åˆ†ã€ç­‰çº§)
- âœ… äº¤æ˜“è®°å½•ç®¡ç†
- âœ… æ´»åŠ¨ç®¡ç† (å‘å¸ƒã€æŠ¥å)
- âœ… åº—é“ºçŠ¶æ€ç®¡ç†
- âœ… ç®¡ç†å‘˜æƒé™ç®¡ç†

#### 3. æµ‹è¯•é¡µé¢
- âœ… äº‘æ•°æ®åº“æµ‹è¯•é¡µé¢ (`pages/cloud-test/cloud-test`)
- âœ… è¿æ¥çŠ¶æ€æ£€æµ‹
- âœ… åŠŸèƒ½æµ‹è¯•æŒ‰é’®
- âœ… å®æ—¶ç»“æœå±•ç¤º

### ğŸ“± å¦‚ä½•ä½¿ç”¨

#### 1. è®¿é—®æµ‹è¯•é¡µé¢
```
å°ç¨‹åºé¡µé¢è·¯å¾„: pages/cloud-test/cloud-test
```

#### 2. æµ‹è¯•äº‘æ•°æ®åº“è¿æ¥
- ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
- æŸ¥çœ‹è¿æ¥çŠ¶æ€æ˜¾ç¤º
- å¦‚æœæ˜¾ç¤º"è¿æ¥æ­£å¸¸"ï¼Œè¯´æ˜äº‘æ•°æ®åº“å·²æ­£ç¡®é…ç½®

#### 3. æµ‹è¯•å„é¡¹åŠŸèƒ½
- **ç”¨æˆ·æ“ä½œ**: æµ‹è¯•ç”¨æˆ·æ³¨å†Œã€ä¿¡æ¯æ›´æ–°ç­‰
- **ä¼šå‘˜å¡æ“ä½œ**: æµ‹è¯•ä¼šå‘˜å¡åˆ›å»ºã€å……å€¼ç­‰
- **äº¤æ˜“è®°å½•**: æµ‹è¯•äº¤æ˜“è®°å½•çš„æ·»åŠ å’ŒæŸ¥è¯¢
- **æ´»åŠ¨æ“ä½œ**: æµ‹è¯•æ´»åŠ¨çš„å‘å¸ƒå’ŒæŠ¥å

#### 4. åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨

```javascript
// å¼•å…¥äº‘æ•°æ®åº“å·¥å…·ç±»
const { WeixinCloudDatabase } = require('../../utils/weixin-cloud-database');

// åˆ›å»ºå®ä¾‹
const cloudDB = new WeixinCloudDatabase();

// ä½¿ç”¨ç¤ºä¾‹ - æ·»åŠ ç”¨æˆ·
async function addUser() {
  try {
    const userData = {
      phone: '13800138000',
      name: 'å¼ ä¸‰',
      avatarUrl: 'https://example.com/avatar.jpg'
    };
    
    const userId = await cloudDB.addUser(userData);
    console.log('ç”¨æˆ·æ·»åŠ æˆåŠŸï¼ŒID:', userId);
  } catch (error) {
    console.error('ç”¨æˆ·æ·»åŠ å¤±è´¥:', error);
  }
}

// ä½¿ç”¨ç¤ºä¾‹ - æŸ¥è¯¢ä¼šå‘˜å¡
async function getMemberCard() {
  try {
    const card = await cloudDB.getMemberCard('13800138000');
    console.log('ä¼šå‘˜å¡ä¿¡æ¯:', card);
  } catch (error) {
    console.error('æŸ¥è¯¢å¤±è´¥:', error);
  }
}
```

### ğŸ”§ äº‘æ•°æ®åº“é›†åˆç»“æ„

#### 1. users (ç”¨æˆ·é›†åˆ)
```javascript
{
  _id: string,           // äº‘æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆçš„ID
  phone: string,         // æ‰‹æœºå·ï¼ˆä¸»é”®ï¼‰
  name: string,        // å§“å
  avatarUrl: string,   // å¤´åƒURL
  registerTime: Date,  // æ³¨å†Œæ—¶é—´
  lastLoginTime: Date  // æœ€åç™»å½•æ—¶é—´
}
```

#### 2. member_cards (ä¼šå‘˜å¡é›†åˆ)
```javascript
{
  _id: string,
  userPhone: string,     // ç”¨æˆ·æ‰‹æœºå·
  balance: number,      // ä½™é¢
  points: number,       // ç§¯åˆ†
  level: string,       // ç­‰çº§ (bronze/silver/gold)
  joinDate: Date,      // åŠ å…¥æ—¶é—´
  lastTransactionTime: Date  // æœ€åäº¤æ˜“æ—¶é—´
}
```

#### 3. transactions (äº¤æ˜“è®°å½•é›†åˆ)
```javascript
{
  _id: string,
  userPhone: string,     // ç”¨æˆ·æ‰‹æœºå·
  type: string,         // äº¤æ˜“ç±»å‹ (recharge/consume)
  amount: number,       // é‡‘é¢
  balanceAfter: number, // äº¤æ˜“åä½™é¢
  description: string,  // æè¿°
  status: string,      // çŠ¶æ€ (completed/pending)
  createdAt: Date      // åˆ›å»ºæ—¶é—´
}
```

#### 4. activities (æ´»åŠ¨é›†åˆ)
```javascript
{
  _id: string,
  title: string,        // æ´»åŠ¨æ ‡é¢˜
  description: string,  // æ´»åŠ¨æè¿°
  startTime: Date,     // å¼€å§‹æ—¶é—´
  endTime: Date,       // ç»“æŸæ—¶é—´
  maxParticipants: number,  // æœ€å¤§å‚ä¸äººæ•°
  currentParticipants: number, // å½“å‰å‚ä¸äººæ•°
  status: string,      // çŠ¶æ€ (active/inactive)
  createdAt: Date      // åˆ›å»ºæ—¶é—´
}
```

#### 5. activity_participants (æ´»åŠ¨å‚ä¸è€…é›†åˆ)
```javascript
{
  _id: string,
  activityId: string,   // æ´»åŠ¨ID
  userPhone: string,    // ç”¨æˆ·æ‰‹æœºå·
  userName: string,     // ç”¨æˆ·å§“å
  joinTime: Date,      // åŠ å…¥æ—¶é—´
  status: string       // çŠ¶æ€ (joined/cancelled)
}
```

### ğŸ› ï¸ äº‘å‡½æ•°æ›´æ–°è¯´æ˜

#### userAuth äº‘å‡½æ•°æ–°å¢åŠŸèƒ½
- `createCollections`: è‡ªåŠ¨åˆ›å»ºäº‘æ•°æ®åº“é›†åˆ
- ç§»é™¤äº† `mysql2` ä¾èµ–ï¼Œä¸“æ³¨äºäº‘æ•°æ®åº“æ“ä½œ
- æ”¯æŒäº‘æ•°æ®åº“å’Œæœ¬åœ°æ•°æ®åº“çš„åŒé‡æ¨¡å¼

### ğŸ“Š æ•°æ®åŒæ­¥

é¡¹ç›®æ”¯æŒä¸¤ç§æ•°æ®å­˜å‚¨æ¨¡å¼ï¼š
1. **äº‘æ•°æ®åº“æ¨¡å¼**: ä½¿ç”¨å¾®ä¿¡äº‘å¼€å‘æ•°æ®åº“å­˜å‚¨
2. **æœ¬åœ°æ•°æ®åº“æ¨¡å¼**: ä½¿ç”¨æœ¬åœ° MySQL æ•°æ®åº“å­˜å‚¨

ç³»ç»Ÿä¼šæ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ¨¡å¼ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚

### ğŸ” æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç¯å¢ƒIDæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤äº‘å¼€å‘ç¯å¢ƒå·²å¼€é€š
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **æƒé™é—®é¢˜**
   - ç¡®è®¤äº‘å‡½æ•°éƒ¨ç½²æˆåŠŸ
   - æ£€æŸ¥æ•°æ®åº“æƒé™è®¾ç½®

3. **æ•°æ®æ“ä½œå¤±è´¥**
   - æ£€æŸ¥æ•°æ®æ ¼å¼æ˜¯å¦ç¬¦åˆè¦æ±‚
   - ç¡®è®¤å¿…å¡«å­—æ®µå·²æä¾›

#### è°ƒè¯•å»ºè®®
- ä½¿ç”¨æµ‹è¯•é¡µé¢è¿›è¡ŒåŠŸèƒ½éªŒè¯
- æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ç¡®ä¿äº‘å‡½æ•°å·²æ­£ç¡®éƒ¨ç½²

### ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š
1. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ—¥å¿—
2. ä½¿ç”¨æµ‹è¯•é¡µé¢è¿›è¡Œè¯Šæ–­
3. æ£€æŸ¥äº‘å¼€å‘æ§åˆ¶å°çŠ¶æ€

---

**æ­å–œï¼æ‚¨çš„é¡¹ç›®å·²æˆåŠŸè¿æ¥åˆ°å¾®ä¿¡äº‘æ•°æ®åº“ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨äº‘å¼€å‘åŠŸèƒ½äº†ï¼** ğŸŠ