<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  - å¾®ä¿¡é£æ ¼ -->
  <view class="status-bar">
    <view class="status-left">
      <text class="status-time">{{currentTime}}</text>
    </view>
    <view class="status-right">
      <text class="status-text">ç‹¼äººæ€æ¡Œæ¸¸åº—</text>
    </view>
  </view>

  <!-- é¡¶éƒ¨å¯¼èˆªæ  - å¾®ä¿¡é£æ ¼ -->
  <view class="nav-header">
    <view class="nav-content">
      <text class="nav-title">æ¡Œæ¸¸åº—</text>
      <view class="nav-actions">
        <view class="nav-action" bindtap="goToSearch">
          <text class="nav-icon">ğŸ”</text>
        </view>
        <view class="nav-action" bindtap="goToMore">
          <text class="nav-icon">â‹¯</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - å®½æ¾å¸ƒå±€ -->
  <scroll-view class="main-content" scroll-y="true">
    <!-- æ¬¢è¿å¡ç‰‡ - å¾®ä¿¡é£æ ¼ -->
    <view class="welcome-card">
      <view class="welcome-header">
        <view class="welcome-avatar">
          <text class="avatar-text">ğŸ²</text>
        </view>
        <view class="welcome-info">
          <text class="welcome-greeting">{{greeting}}</text>
          <text class="welcome-subtitle">{{isLoggedIn ? 'æ¬¢è¿å›æ¥ï¼Œ' + userInfo.name : 'ç™»å½•è§£é”æ›´å¤šåŠŸèƒ½'}}</text>
        </view>
      </view>
      <view class="welcome-stats">
        <view class="stat-item">
          <text class="stat-number">{{todayActivities.length}}</text>
          <text class="stat-label">ä»Šæ—¥æ´»åŠ¨</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{recommendedActivities.length}}</text>
          <text class="stat-label">æ¨èæ´»åŠ¨</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{storeStatus.isOpen ? 'è¥ä¸š' : 'ä¼‘æ¯'}}</text>
          <text class="stat-label">åº—é“ºçŠ¶æ€</text>
        </view>
      </view>
    </view>

    <!-- åº—é“ºçŠ¶æ€å¡ç‰‡ - å¾®ä¿¡é£æ ¼ -->
    <view class="store-card" bindtap="goToStoreStatus">
      <view class="store-header">
        <view class="store-icon">
          <text class="icon">{{storeStatus.isOpen ? 'ğŸª' : 'ğŸŒ™'}}</text>
        </view>
        <view class="store-info">
          <text class="store-title">åº—é“ºçŠ¶æ€</text>
          <text class="store-status">{{storeStatus.isOpen ? 'æ­£åœ¨è¥ä¸š' : 'å·²æ‰“çƒŠ'}}</text>
        </view>
        <view class="store-indicator">
          <view class="status-dot {{storeStatus.isOpen ? 'active' : 'inactive'}}"></view>
          <text class="store-time">{{storeStatus.openTime || 'ä»Šæ—¥ä¼‘æ¯'}}</text>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œåŒºåŸŸ - å®½æ¾å¸ƒå±€ -->
    <view class="quick-actions">
      <view class="action-section">
        <text class="section-title">å¿«æ·æ“ä½œ</text>
        <view class="action-grid">
          <view class="action-item primary" bindtap="goToCreateActivity">
            <view class="action-icon">
              <text class="icon">â•</text>
            </view>
            <text class="action-text">åˆ›å»ºæ´»åŠ¨</text>
            <text class="action-desc">å‘èµ·æ–°çš„æ¡Œæ¸¸æ´»åŠ¨</text>
          </view>
          <view class="action-item secondary" bindtap="goToMemberCard">
            <view class="action-icon">
              <text class="icon">ğŸ‘¤</text>
            </view>
            <text class="action-text">ç”¨æˆ·ä¸­å¿ƒ</text>
            <text class="action-desc">æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç®¡ç†å‘˜å·¥å…· - å¾®ä¿¡é£æ ¼ -->
    <view class="admin-section" wx:if="{{isAdmin}}">
      <view class="section-header">
        <text class="section-title">ç®¡ç†å·¥å…·</text>
        <text class="section-more">å…¨éƒ¨å·¥å…·</text>
      </view>
      <view class="admin-grid">
        <view class="admin-item" bindtap="goToStoreStatusManagement">
          <view class="admin-icon store">
            <text class="icon">ğŸª</text>
          </view>
          <text class="admin-text">åº—é“ºç®¡ç†</text>
        </view>
        <view class="admin-item" bindtap="goToMemberManagement">
          <view class="admin-icon member">
            <text class="icon">ğŸ‘¥</text>
          </view>
          <text class="admin-text">ç”¨æˆ·ç®¡ç†</text>
        </view>
        <view class="admin-item" bindtap="goToFinancialReport">
          <view class="admin-icon finance">
            <text class="icon">ğŸ“Š</text>
          </view>
          <text class="admin-text">è´¢åŠ¡æŠ¥å‘Š</text>
        </view>
        <view class="admin-item" bindtap="goToSystemSettings">
          <view class="admin-icon settings">
            <text class="icon">âš™ï¸</text>
          </view>
          <text class="admin-text">ç³»ç»Ÿè®¾ç½®</text>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨åˆ—è¡¨ - å¾®ä¿¡é£æ ¼ -->
    <view class="activities-section" wx:if="{{todayActivities.length > 0 || recommendedActivities.length > 0}}">
      <view class="section-header">
        <text class="section-title">æ´»åŠ¨æ¨è</text>
        <text class="section-more" bindtap="goToActivityList">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      
      <view class="activity-list">
        <!-- ä»Šæ—¥æ´»åŠ¨ -->
        <view class="activity-item today" wx:for="{{todayActivities}}" wx:key="id" bindtap="goToActivityDetail" data-id="{{item.id}}">
          <view class="activity-avatar">
            <text class="avatar-icon">ğŸ¯</text>
          </view>
          <view class="activity-content">
            <view class="activity-title-row">
              <text class="activity-tag today">ä»Šæ—¥</text>
              <text class="activity-title">{{item.title}}</text>
            </view>
            <view class="activity-info">
              <text class="activity-time">â° {{item.time}}</text>
              <text class="activity-players">ğŸ‘¥ {{item.currentPlayers}}/{{item.maxPlayers}}äºº</text>
            </view>
            <view class="activity-progress">
              <view class="progress-bar">
                <view class="progress-fill" style="width: {{(item.currentPlayers / item.maxPlayers) * 100}}%"></view>
              </view>
              <text class="progress-text">{{Math.round((item.currentPlayers / item.maxPlayers) * 100)}}%</text>
            </view>
          </view>
        </view>

        <!-- æ¨èæ´»åŠ¨ -->
        <view class="activity-item recommend" wx:for="{{recommendedActivities}}" wx:key="id" bindtap="goToActivityDetail" data-id="{{item.id}}">
          <view class="activity-avatar">
            <text class="avatar-icon">â­</text>
          </view>
          <view class="activity-content">
            <view class="activity-title-row">
              <text class="activity-tag recommend">æ¨è</text>
              <text class="activity-title">{{item.title}}</text>
            </view>
            <view class="activity-info">
              <text class="activity-date">ğŸ“… {{item.date}}</text>
              <text class="activity-time">â° {{item.time}}</text>
            </view>
            <view class="activity-footer">
              <text class="activity-players">ğŸ‘¥ {{item.currentPlayers}}/{{item.maxPlayers}}äºº</text>
              <view class="join-btn">åŠ å…¥</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ - å¾®ä¿¡é£æ ¼ -->
    <view class="empty-section" wx:if="{{todayActivities.length === 0 && recommendedActivities.length === 0}}">
      <view class="empty-card">
        <view class="empty-icon">ğŸ²</view>
        <text class="empty-title">æš‚æ— æ´»åŠ¨</text>
        <text class="empty-desc">æˆä¸ºç¬¬ä¸€ä¸ªå‘èµ·æ´»åŠ¨çš„äººå§ï¼</text>
        <view class="empty-action" bindtap="goToCreateActivity">
          <text class="action-text">åˆ›å»ºæ´»åŠ¨</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view class="bottom-spacing"></view>
  </scroll-view>

  <!-- åº•éƒ¨æ ‡ç­¾æ å ä½ -->
  <view class="tab-bar-placeholder"></view>
</view>