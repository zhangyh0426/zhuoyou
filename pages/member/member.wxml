<!--pages/member/member.wxml-->
<view class="container">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-left">
      <text class="nav-title">ç”¨æˆ·ä¸­å¿ƒ</text>
    </view>
    <view class="nav-right">
      <text class="nav-icon" bindtap="goToSearch">ğŸ”</text>
      <text class="nav-icon" bindtap="goToMore">+</text>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view scroll-y class="content">
    <!-- æœªç™»å½•çŠ¶æ€ -->
    <view class="not-logged-in" wx:if="{{!isLoggedIn}}">
      <view class="welcome-card">
        <view class="welcome-icon">ğŸ‘‹</view>
        <text class="greeting">{{greeting}}</text>
        <text class="welcome-subtitle">æ¬¢è¿æ¥åˆ°ç‹¼äººæ€æ¡Œæ¸¸åº—</text>
        <text class="welcome-desc">ç™»å½•åäº«å—ä¸“å±ç”¨æˆ·æœåŠ¡</text>
        <button class="login-button" bindtap="goToLogin">
          <text class="login-text">ç«‹å³ç™»å½•</text>
        </button>
      </view>
    </view>

    <!-- å·²ç™»å½•çŠ¶æ€ -->
    <view class="member-info" wx:else>
      <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
      <view class="profile-section">
        <view class="profile-card">
          <view class="profile-left">
            <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" />
            <view class="user-badge" wx:if="{{userInfo.phone === '13800000000' || userInfo.phone === '13900000000'}}">
              <text class="badge-text">ğŸ‘‘ ç®¡ç†å‘˜</text>
            </view>
          </view>
          <view class="user-details">
            <text class="user-name">{{userInfo.name}}</text>
            <text class="user-phone">{{userInfo.phone}}</text>

          </view>
          <view class="logout-btn" bindtap="logout">
            <text class="logout-icon">ğŸšª</text>
          </view>
        </view>
      </view>

      <!-- ä½™é¢å¡ç‰‡ -->
      <view class="balance-section">
        <view class="balance-card">
          <view class="balance-header">
            <text class="balance-title">è´¦æˆ·ä½™é¢</text>
            <text class="balance-desc">å¯ç”¨äºæ´»åŠ¨æ¶ˆè´¹</text>
          </view>
          <view class="balance-amount">
            <text class="balance-currency">Â¥</text>
            <text class="balance-number">{{balance.toFixed(2)}}</text>
          </view>
          <!-- åªä¿ç•™ä½™é¢æ˜¾ç¤ºï¼Œç§»é™¤å……å€¼åŠŸèƒ½ -->
        </view>
      </view>

      <!-- äº¤æ˜“è®°å½• -->
      <view class="history-section">
        <view class="section-header">
          <text class="section-title">äº¤æ˜“è®°å½•</text>
          <text class="section-count">å…±{{transactionHistory.length}}ç¬”</text>
        </view>
        
        <view class="transaction-list">
          <view 
            class="transaction-item" 
            wx:for="{{transactionHistory}}" 
            wx:key="id"
            bindtap="viewTransactionDetail"
            data-transaction="{{item}}"
          >
            <view class="transaction-icon">
              <text class="icon-{{item.type === 'æ¶ˆè´¹' ? 'expense' : 'income'}}">{{item.type === 'æ¶ˆè´¹' ? 'ğŸ’¸' : 'ğŸ’°'}}</text>
            </view>
            <view class="transaction-main">
              <text class="transaction-type">{{item.type}}</text>
              <text class="transaction-date">{{item.date}}</text>
            </view>
            <view class="transaction-amount">
              <text class="amount-{{item.type === 'æ¶ˆè´¹' ? 'expense' : 'income'}}">
                {{item.type === 'æ¶ˆè´¹' ? '-' : '+'}}Â¥{{item.amount.toFixed(2)}}
              </text>
              <text class="transaction-balance">ä½™é¢ Â¥{{item.balance.toFixed(2)}}</text>
            </view>
          </view>
          
          <view class="no-transactions" wx:if="{{transactionHistory.length === 0}}">
            <view class="empty-icon">ğŸ“‹</view>
            <text class="no-transactions-text">æš‚æ— äº¤æ˜“è®°å½•</text>
            <text class="no-transactions-desc">å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡æ¶ˆè´¹å§ï¼</text>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨ç©ºç™½åŒºåŸŸ -->
      <view class="bottom-space"></view>
    </view>
  </scroll-view>
</view>